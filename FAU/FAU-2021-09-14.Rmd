---
title: "Modeling your research data: A crash course using R"
author: "ses"
date: "9/14/2021"
output: html_document
---


# Data wrangling

## Exercise


Which three airlines do show the greatest average delay in the first quarter?

(Use the tidyverse approach.)

You'll find the data set (including description) [here](https://vincentarelbundock.github.io/Rdatasets/doc/nycflights13/flights.html).

## Solution


### In pseudo code

take data "flights" THEN
filter month jan to march THEN
select delay THEN
group by airline (carrier) THEN
summarise mean delay
arrange mean delay from biggest to smallest THEN
filter delay the three largest mean delays

### In R code

Some preparation:


```{r}
# make sure to install the packages (one time only!) 
library(nycflights13)  # unless the package is on your machine
data(flights)
library(tidyverse)  # including ggplot, dplyr, ....
```

And now the R code:

```{r}
flights %>% # "and then do command, called the pipe, Contrl-Shift-M"
  filter(month <= 3) %>% 
  select(month, dep_delay, carrier) %>% 
  drop_na() %>%  # drop all rows with missing data, for simplicity
  group_by(carrier) %>% 
  summarise(dep_delay_avg = mean(dep_delay))  %>%   # y = f(x)
  arrange(-dep_delay_avg) %>% 
  mutate(position = 1:16) %>% 
  filter(position <= 3)
```



# Data viz


## Research question 1

Is there a correlation between delay and flight distance?


```{r}
flights %>% 
  select(dep_delay, distance) %>% 
  sample_n(size = 1000) %>%  # for speed
  ggplot() + 
  aes(x = distance, y = dep_delay) +
  geom_point() +
  geom_smooth()
```





## Research question 2

Is there a correlation between delay and flight distance? What is if we split the analysis (correlation) for each airport? (sub group analysis)


```{r}
flights %>% 
  select(dep_delay, distance, origin) %>% 
  sample_n(size = 1000) %>%  # for speed
  ggplot() + 
  aes(x = distance, y = dep_delay, color = origin) +
  geom_point()+
  geom_smooth()
```


## RQ 3

What is the distribution for delay in each month for each airport? Be sure to add a measure of centrality (e.g. median) and for spead (e.g., sd or IQR).


Tipp 1: Boxplots are depicted using the command `geom_boxplot()`!
Tipp 2: Scribble before you code.

*11.40am back here*


```{r}
flights %>% 
  select(dep_delay) %>% 
  drop_na() %>% 
  summarise(mean(dep_delay),
            sd(dep_delay))
```

A rough rule of thumb is:

outlier is greater than mean + 2*sd.

```{r}
uprlimit <- 12.6 + 2*40.2
uprlimit
```


```{r}
flights %>% 
  sample_n(1000) %>% 
  mutate(is_outlier = ifelse(dep_delay > 93, 1, 0)) %>% 
  filter(is_outlier == 0) %>% 
  select(dep_delay, month, origin) %>% 
  mutate(month_nominal = factor(month)) %>% 
  ggplot() +
  aes(x = month_nominal, y = dep_delay, color = origin) +
  geom_boxplot()
```

There seems to be a bit less delay in winter times.




